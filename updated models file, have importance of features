{
  "cells": [
    {
      "cell_type": "code",
      "execution_count": 5,
      "id": "ecbe5ee5",
      "metadata": {
        "id": "ecbe5ee5"
      },
      "outputs": [],
      "source": [
        "import numpy as np\n",
        "import pandas as pd\n",
        "import ast\n"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### GPU Acceleration --IGNORE IF NOT USING COLAB--"
      ],
      "metadata": {
        "id": "37WpkwVyaTpj"
      },
      "id": "37WpkwVyaTpj"
    },
    {
      "cell_type": "code",
      "source": [
        "# Below line allows for GPU acceleration of sci-kit modeling apis\n",
        "%load_ext cuml.accel"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "oFJYpBxHW48f",
        "outputId": "57788e5e-620d-435b-c588-753a1ac43371"
      },
      "id": "oFJYpBxHW48f",
      "execution_count": 2,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "cuML: Accelerator installed.\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "d3bcfb34",
        "outputId": "7b40714d-8c8e-45f6-cb4e-8f71c9aafeca"
      },
      "source": [
        "#checking cuml and IPython versions, some versions are not compatible. cuml 25.06.00 and IPython 7.34.0 are compatible\n",
        "\n",
        "import IPython\n",
        "print(f\"IPython version: {IPython.__version__}\")\n",
        "\n",
        "try:\n",
        "    import cuml\n",
        "    print(f\"cuml version: {cuml.__version__}\")\n",
        "except ImportError:\n",
        "    print(\"cuml is not installed or could not be imported.\")"
      ],
      "id": "d3bcfb34",
      "execution_count": 3,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "IPython version: 7.34.0\n",
            "cuml version: 25.06.00\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### If you are mounting the files from drive"
      ],
      "metadata": {
        "id": "Kc-5gTTNapW1"
      },
      "id": "Kc-5gTTNapW1"
    },
    {
      "cell_type": "code",
      "source": [
        "from google.colab import drive\n",
        "drive.mount('/content/drive')"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "cPuEcFBale6Z",
        "outputId": "a64b1fc3-da6b-4124-b7f4-f1ab5b25c4c8"
      },
      "id": "cPuEcFBale6Z",
      "execution_count": 1,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Mounted at /content/drive\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "#### Using CSV"
      ],
      "metadata": {
        "id": "HNv08VPZaxM5"
      },
      "id": "HNv08VPZaxM5"
    },
    {
      "cell_type": "code",
      "execution_count": 6,
      "id": "658d6177",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "658d6177",
        "outputId": "fe1d3f26-f5dd-4db3-cbc7-a0ccfdb1a0e3"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Finished reading CSV, now converting claim_text column to python list objects\n"
          ]
        }
      ],
      "source": [
        "main_combined_df_path = '/content/drive/MyDrive/final combined data/all_features_df.csv'\n",
        "# main_combined_df_path = 'all_features_df.csv'\n",
        "df = pd.read_csv(main_combined_df_path)\n",
        "print(\"Finished reading CSV, now converting claim_text column to python list objects\")\n",
        "df['claim_text'] = df['claim_text'].apply(ast.literal_eval)\n",
        "\n"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df= df.drop(columns=[\"number_of_oa\",\t\"unique_rej_types\",\t\"num_office_actions\",\t\"oa_span_days\",\t\"mean_gap_days\",\t\"min_gap_days\",\t\"max_gap_days\"])"
      ],
      "metadata": {
        "id": "nSkL0LIYZTzl"
      },
      "id": "nSkL0LIYZTzl",
      "execution_count": 10,
      "outputs": []
    },
    {
      "cell_type": "code",
      "execution_count": 11,
      "id": "2580ff53",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 903
        },
        "id": "2580ff53",
        "outputId": "37a34975-aeec-42fb-a4bd-2fc33e89af06"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Index(['application_number', 'y_approved', 'y_101', 'y_102', 'y_103', 'y_112',\n",
            "       'claim_text', 'entity_size_MICRO', 'entity_size_SMALL',\n",
            "       'entity_size_UNDISCOUNTED',\n",
            "       ...\n",
            "       'art_unit_cat_Biotech and Organic Chemistry',\n",
            "       'art_unit_cat_Chemical and Materials Engineering',\n",
            "       'art_unit_cat_Communications',\n",
            "       'art_unit_cat_Computer Architecture and Software',\n",
            "       'art_unit_cat_Design',\n",
            "       'art_unit_cat_Mechanical Engineering, Manufacturing, and Products',\n",
            "       'art_unit_cat_Networking, Multiplexing, Cable, and Cybersecurity',\n",
            "       'art_unit_cat_Other',\n",
            "       'art_unit_cat_Semiconductors/Memory, Circuits/Measuring and Testing, Optics/Photocopying, Printing/Measuring and Testing',\n",
            "       'art_unit_cat_Transportation, Construction, Electronic Commerce, Agriculture, National Security and License and Review'],\n",
            "      dtype='object', length=219)\n",
            "3909923\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "   application_number  y_approved  y_101  y_102  y_103  y_112  \\\n",
              "0            13816709           1      1      1      1      1   \n",
              "1            15998927           1      0      1      1      1   \n",
              "2            16310515           0      0      1      1      1   \n",
              "3            16339059           0      0      1      1      1   \n",
              "4            16310291           0      0      1      1      1   \n",
              "\n",
              "                                          claim_text  entity_size_MICRO  \\\n",
              "0  [nonamplifi, detect, polynucleotid, probe, pro...              False   \n",
              "1  [compound, follow, formula, pharmaceut, accept...              False   \n",
              "2  [method, target, genom, modif, within, target,...              False   \n",
              "3  [mammalian, cell, line, compris, first, hetero...              False   \n",
              "4  [method, determin, amount, andor, concentr, sa...              False   \n",
              "\n",
              "   entity_size_SMALL  entity_size_UNDISCOUNTED  aia_first_to_file_False  \\\n",
              "0              False                      True                     True   \n",
              "1               True                     False                     True   \n",
              "2               True                     False                     True   \n",
              "3              False                      True                     True   \n",
              "4              False                      True                     True   \n",
              "\n",
              "   aia_first_to_file_True  groupartunitnumber_x  years_since_pub  country_AD  \\\n",
              "0                   False                1634.0         8.933607           0   \n",
              "1                   False                1624.0         2.491444           0   \n",
              "2                   False                1635.0         2.258727           0   \n",
              "3                   False                1633.0         0.000000           0   \n",
              "4                   False                1678.0         2.453114           0   \n",
              "\n",
              "   country_AE  country_AG  country_AI  country_AL  country_AM  country_AN  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_AO  country_AR  country_AS  country_AT  country_AU  country_AW  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_AZ  country_BA  country_BB  country_BD  country_BE  country_BF  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           1           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           1           0   \n",
              "\n",
              "   country_BG  country_BH  country_BI  country_BM  country_BN  country_BO  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_BR  country_BS  country_BV  country_BY  country_BZ  country_CA  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_CB  country_CH  country_CI  country_CK  country_CL  country_CM  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_CN  country_CO  country_CR  country_CU  country_CV  country_CW  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           1           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_CY  country_CZ  country_DE  country_DK  country_DM  country_DO  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_DZ  country_EC  country_EE  country_EG  country_EI  country_ER  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_ES  country_ET  country_FI  country_FO  country_FR  country_GA  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_GB  country_GD  country_GE  country_GG  country_GH  country_GI  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_GN  country_GR  country_GT  country_HB  country_HK  country_HM  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_HN  country_HR  country_HT  country_HU  country_ID  country_IE  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_IL  country_IM  country_IN  country_IO  country_IQ  country_IR  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_IS  country_IT  country_J  country_JE  country_JM  country_JO  \\\n",
              "0           0           0          0           0           0           0   \n",
              "1           0           0          0           0           0           0   \n",
              "2           0           0          0           0           0           0   \n",
              "3           0           0          0           0           0           0   \n",
              "4           0           0          0           0           0           0   \n",
              "\n",
              "   country_JP  country_KE  country_KH  country_KI  country_KN  country_KP  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_KR  country_KW  country_KY  country_KZ  country_LB  country_LC  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_LI  country_LK  country_LT  country_LU  country_LV  country_LX  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_MA  country_MC  country_MD  country_ME  country_MG  country_MH  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_MI  country_MK  country_MM  country_MN  country_MO  country_MR  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_MT  country_MU  country_MX  country_MY  country_MZ  country_N  \\\n",
              "0           0           0           0           0           0          0   \n",
              "1           0           0           0           0           0          0   \n",
              "2           0           0           0           0           0          0   \n",
              "3           0           0           0           0           0          0   \n",
              "4           0           0           0           0           0          0   \n",
              "\n",
              "   country_NA  country_NC  country_NE  country_NG  country_NJ  country_NL  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_NO  country_NP  country_NY  country_NZ  country_OM  country_PA  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_PE  country_PH  country_PK  country_PL  country_PR  country_PS  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_PT  country_PY  country_QA  country_RO  country_RS  country_RU  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_SA  country_SC  country_SD  country_SE  country_SG  country_SH  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_SI  country_SK  country_SL  country_SM  country_SN  country_SR  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_SS  country_SV  country_SW  country_SZ  country_T  country_TC  \\\n",
              "0           0           0           0           0          0           0   \n",
              "1           0           0           0           0          0           0   \n",
              "2           0           0           0           0          0           0   \n",
              "3           0           0           0           0          0           0   \n",
              "4           0           0           0           0          0           0   \n",
              "\n",
              "   country_TH  country_TI  country_TK  country_TN  country_TO  country_TR  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_TS  country_TT  country_TW  country_UA  country_UK  country_US  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_UY  country_UZ  country_VA  country_VC  country_VE  country_VG  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_VI  country_VN  country_VU  country_WS  country_YR  country_ZA  \\\n",
              "0           0           0           0           0           0           0   \n",
              "1           0           0           0           0           0           0   \n",
              "2           0           0           0           0           0           0   \n",
              "3           0           0           0           0           0           0   \n",
              "4           0           0           0           0           0           0   \n",
              "\n",
              "   country_ZW  country_na  art_unit_cat_Biotech and Organic Chemistry  \\\n",
              "0           0           1                                           1   \n",
              "1           0           0                                           1   \n",
              "2           0           0                                           1   \n",
              "3           0           1                                           1   \n",
              "4           0           0                                           1   \n",
              "\n",
              "   art_unit_cat_Chemical and Materials Engineering  \\\n",
              "0                                                0   \n",
              "1                                                0   \n",
              "2                                                0   \n",
              "3                                                0   \n",
              "4                                                0   \n",
              "\n",
              "   art_unit_cat_Communications  \\\n",
              "0                            0   \n",
              "1                            0   \n",
              "2                            0   \n",
              "3                            0   \n",
              "4                            0   \n",
              "\n",
              "   art_unit_cat_Computer Architecture and Software  art_unit_cat_Design  \\\n",
              "0                                                0                    0   \n",
              "1                                                0                    0   \n",
              "2                                                0                    0   \n",
              "3                                                0                    0   \n",
              "4                                                0                    0   \n",
              "\n",
              "   art_unit_cat_Mechanical Engineering, Manufacturing, and Products  \\\n",
              "0                                                  0                  \n",
              "1                                                  0                  \n",
              "2                                                  0                  \n",
              "3                                                  0                  \n",
              "4                                                  0                  \n",
              "\n",
              "   art_unit_cat_Networking, Multiplexing, Cable, and Cybersecurity  \\\n",
              "0                                                  0                 \n",
              "1                                                  0                 \n",
              "2                                                  0                 \n",
              "3                                                  0                 \n",
              "4                                                  0                 \n",
              "\n",
              "   art_unit_cat_Other  \\\n",
              "0                   0   \n",
              "1                   0   \n",
              "2                   0   \n",
              "3                   0   \n",
              "4                   0   \n",
              "\n",
              "   art_unit_cat_Semiconductors/Memory, Circuits/Measuring and Testing, Optics/Photocopying, Printing/Measuring and Testing  \\\n",
              "0                                                  0                                                                         \n",
              "1                                                  0                                                                         \n",
              "2                                                  0                                                                         \n",
              "3                                                  0                                                                         \n",
              "4                                                  0                                                                         \n",
              "\n",
              "   art_unit_cat_Transportation, Construction, Electronic Commerce, Agriculture, National Security and License and Review  \n",
              "0                                                  0                                                                      \n",
              "1                                                  0                                                                      \n",
              "2                                                  0                                                                      \n",
              "3                                                  0                                                                      \n",
              "4                                                  0                                                                      "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-3efc29f4-49dc-483c-ab07-1d7099b065e0\" class=\"colab-df-container\">\n",
              "    <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>application_number</th>\n",
              "      <th>y_approved</th>\n",
              "      <th>y_101</th>\n",
              "      <th>y_102</th>\n",
              "      <th>y_103</th>\n",
              "      <th>y_112</th>\n",
              "      <th>claim_text</th>\n",
              "      <th>entity_size_MICRO</th>\n",
              "      <th>entity_size_SMALL</th>\n",
              "      <th>entity_size_UNDISCOUNTED</th>\n",
              "      <th>aia_first_to_file_False</th>\n",
              "      <th>aia_first_to_file_True</th>\n",
              "      <th>groupartunitnumber_x</th>\n",
              "      <th>years_since_pub</th>\n",
              "      <th>country_AD</th>\n",
              "      <th>country_AE</th>\n",
              "      <th>country_AG</th>\n",
              "      <th>country_AI</th>\n",
              "      <th>country_AL</th>\n",
              "      <th>country_AM</th>\n",
              "      <th>country_AN</th>\n",
              "      <th>country_AO</th>\n",
              "      <th>country_AR</th>\n",
              "      <th>country_AS</th>\n",
              "      <th>country_AT</th>\n",
              "      <th>country_AU</th>\n",
              "      <th>country_AW</th>\n",
              "      <th>country_AZ</th>\n",
              "      <th>country_BA</th>\n",
              "      <th>country_BB</th>\n",
              "      <th>country_BD</th>\n",
              "      <th>country_BE</th>\n",
              "      <th>country_BF</th>\n",
              "      <th>country_BG</th>\n",
              "      <th>country_BH</th>\n",
              "      <th>country_BI</th>\n",
              "      <th>country_BM</th>\n",
              "      <th>country_BN</th>\n",
              "      <th>country_BO</th>\n",
              "      <th>country_BR</th>\n",
              "      <th>country_BS</th>\n",
              "      <th>country_BV</th>\n",
              "      <th>country_BY</th>\n",
              "      <th>country_BZ</th>\n",
              "      <th>country_CA</th>\n",
              "      <th>country_CB</th>\n",
              "      <th>country_CH</th>\n",
              "      <th>country_CI</th>\n",
              "      <th>country_CK</th>\n",
              "      <th>country_CL</th>\n",
              "      <th>country_CM</th>\n",
              "      <th>country_CN</th>\n",
              "      <th>country_CO</th>\n",
              "      <th>country_CR</th>\n",
              "      <th>country_CU</th>\n",
              "      <th>country_CV</th>\n",
              "      <th>country_CW</th>\n",
              "      <th>country_CY</th>\n",
              "      <th>country_CZ</th>\n",
              "      <th>country_DE</th>\n",
              "      <th>country_DK</th>\n",
              "      <th>country_DM</th>\n",
              "      <th>country_DO</th>\n",
              "      <th>country_DZ</th>\n",
              "      <th>country_EC</th>\n",
              "      <th>country_EE</th>\n",
              "      <th>country_EG</th>\n",
              "      <th>country_EI</th>\n",
              "      <th>country_ER</th>\n",
              "      <th>country_ES</th>\n",
              "      <th>country_ET</th>\n",
              "      <th>country_FI</th>\n",
              "      <th>country_FO</th>\n",
              "      <th>country_FR</th>\n",
              "      <th>country_GA</th>\n",
              "      <th>country_GB</th>\n",
              "      <th>country_GD</th>\n",
              "      <th>country_GE</th>\n",
              "      <th>country_GG</th>\n",
              "      <th>country_GH</th>\n",
              "      <th>country_GI</th>\n",
              "      <th>country_GN</th>\n",
              "      <th>country_GR</th>\n",
              "      <th>country_GT</th>\n",
              "      <th>country_HB</th>\n",
              "      <th>country_HK</th>\n",
              "      <th>country_HM</th>\n",
              "      <th>country_HN</th>\n",
              "      <th>country_HR</th>\n",
              "      <th>country_HT</th>\n",
              "      <th>country_HU</th>\n",
              "      <th>country_ID</th>\n",
              "      <th>country_IE</th>\n",
              "      <th>country_IL</th>\n",
              "      <th>country_IM</th>\n",
              "      <th>country_IN</th>\n",
              "      <th>country_IO</th>\n",
              "      <th>country_IQ</th>\n",
              "      <th>country_IR</th>\n",
              "      <th>country_IS</th>\n",
              "      <th>country_IT</th>\n",
              "      <th>country_J</th>\n",
              "      <th>country_JE</th>\n",
              "      <th>country_JM</th>\n",
              "      <th>country_JO</th>\n",
              "      <th>country_JP</th>\n",
              "      <th>country_KE</th>\n",
              "      <th>country_KH</th>\n",
              "      <th>country_KI</th>\n",
              "      <th>country_KN</th>\n",
              "      <th>country_KP</th>\n",
              "      <th>country_KR</th>\n",
              "      <th>country_KW</th>\n",
              "      <th>country_KY</th>\n",
              "      <th>country_KZ</th>\n",
              "      <th>country_LB</th>\n",
              "      <th>country_LC</th>\n",
              "      <th>country_LI</th>\n",
              "      <th>country_LK</th>\n",
              "      <th>country_LT</th>\n",
              "      <th>country_LU</th>\n",
              "      <th>country_LV</th>\n",
              "      <th>country_LX</th>\n",
              "      <th>country_MA</th>\n",
              "      <th>country_MC</th>\n",
              "      <th>country_MD</th>\n",
              "      <th>country_ME</th>\n",
              "      <th>country_MG</th>\n",
              "      <th>country_MH</th>\n",
              "      <th>country_MI</th>\n",
              "      <th>country_MK</th>\n",
              "      <th>country_MM</th>\n",
              "      <th>country_MN</th>\n",
              "      <th>country_MO</th>\n",
              "      <th>country_MR</th>\n",
              "      <th>country_MT</th>\n",
              "      <th>country_MU</th>\n",
              "      <th>country_MX</th>\n",
              "      <th>country_MY</th>\n",
              "      <th>country_MZ</th>\n",
              "      <th>country_N</th>\n",
              "      <th>country_NA</th>\n",
              "      <th>country_NC</th>\n",
              "      <th>country_NE</th>\n",
              "      <th>country_NG</th>\n",
              "      <th>country_NJ</th>\n",
              "      <th>country_NL</th>\n",
              "      <th>country_NO</th>\n",
              "      <th>country_NP</th>\n",
              "      <th>country_NY</th>\n",
              "      <th>country_NZ</th>\n",
              "      <th>country_OM</th>\n",
              "      <th>country_PA</th>\n",
              "      <th>country_PE</th>\n",
              "      <th>country_PH</th>\n",
              "      <th>country_PK</th>\n",
              "      <th>country_PL</th>\n",
              "      <th>country_PR</th>\n",
              "      <th>country_PS</th>\n",
              "      <th>country_PT</th>\n",
              "      <th>country_PY</th>\n",
              "      <th>country_QA</th>\n",
              "      <th>country_RO</th>\n",
              "      <th>country_RS</th>\n",
              "      <th>country_RU</th>\n",
              "      <th>country_SA</th>\n",
              "      <th>country_SC</th>\n",
              "      <th>country_SD</th>\n",
              "      <th>country_SE</th>\n",
              "      <th>country_SG</th>\n",
              "      <th>country_SH</th>\n",
              "      <th>country_SI</th>\n",
              "      <th>country_SK</th>\n",
              "      <th>country_SL</th>\n",
              "      <th>country_SM</th>\n",
              "      <th>country_SN</th>\n",
              "      <th>country_SR</th>\n",
              "      <th>country_SS</th>\n",
              "      <th>country_SV</th>\n",
              "      <th>country_SW</th>\n",
              "      <th>country_SZ</th>\n",
              "      <th>country_T</th>\n",
              "      <th>country_TC</th>\n",
              "      <th>country_TH</th>\n",
              "      <th>country_TI</th>\n",
              "      <th>country_TK</th>\n",
              "      <th>country_TN</th>\n",
              "      <th>country_TO</th>\n",
              "      <th>country_TR</th>\n",
              "      <th>country_TS</th>\n",
              "      <th>country_TT</th>\n",
              "      <th>country_TW</th>\n",
              "      <th>country_UA</th>\n",
              "      <th>country_UK</th>\n",
              "      <th>country_US</th>\n",
              "      <th>country_UY</th>\n",
              "      <th>country_UZ</th>\n",
              "      <th>country_VA</th>\n",
              "      <th>country_VC</th>\n",
              "      <th>country_VE</th>\n",
              "      <th>country_VG</th>\n",
              "      <th>country_VI</th>\n",
              "      <th>country_VN</th>\n",
              "      <th>country_VU</th>\n",
              "      <th>country_WS</th>\n",
              "      <th>country_YR</th>\n",
              "      <th>country_ZA</th>\n",
              "      <th>country_ZW</th>\n",
              "      <th>country_na</th>\n",
              "      <th>art_unit_cat_Biotech and Organic Chemistry</th>\n",
              "      <th>art_unit_cat_Chemical and Materials Engineering</th>\n",
              "      <th>art_unit_cat_Communications</th>\n",
              "      <th>art_unit_cat_Computer Architecture and Software</th>\n",
              "      <th>art_unit_cat_Design</th>\n",
              "      <th>art_unit_cat_Mechanical Engineering, Manufacturing, and Products</th>\n",
              "      <th>art_unit_cat_Networking, Multiplexing, Cable, and Cybersecurity</th>\n",
              "      <th>art_unit_cat_Other</th>\n",
              "      <th>art_unit_cat_Semiconductors/Memory, Circuits/Measuring and Testing, Optics/Photocopying, Printing/Measuring and Testing</th>\n",
              "      <th>art_unit_cat_Transportation, Construction, Electronic Commerce, Agriculture, National Security and License and Review</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>13816709</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>[nonamplifi, detect, polynucleotid, probe, pro...</td>\n",
              "      <td>False</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>1634.0</td>\n",
              "      <td>8.933607</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>15998927</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>[compound, follow, formula, pharmaceut, accept...</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>1624.0</td>\n",
              "      <td>2.491444</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>16310515</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>[method, target, genom, modif, within, target,...</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>1635.0</td>\n",
              "      <td>2.258727</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>16339059</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>[mammalian, cell, line, compris, first, hetero...</td>\n",
              "      <td>False</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>1633.0</td>\n",
              "      <td>0.000000</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>16310291</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>[method, determin, amount, andor, concentr, sa...</td>\n",
              "      <td>False</td>\n",
              "      <td>False</td>\n",
              "      <td>True</td>\n",
              "      <td>True</td>\n",
              "      <td>False</td>\n",
              "      <td>1678.0</td>\n",
              "      <td>2.453114</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "    <div class=\"colab-df-buttons\">\n",
              "\n",
              "  <div class=\"colab-df-container\">\n",
              "    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-3efc29f4-49dc-483c-ab07-1d7099b065e0')\"\n",
              "            title=\"Convert this dataframe to an interactive table.\"\n",
              "            style=\"display:none;\">\n",
              "\n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n",
              "    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n",
              "  </svg>\n",
              "    </button>\n",
              "\n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    .colab-df-buttons div {\n",
              "      margin-bottom: 4px;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "    <script>\n",
              "      const buttonEl =\n",
              "        document.querySelector('#df-3efc29f4-49dc-483c-ab07-1d7099b065e0 button.colab-df-convert');\n",
              "      buttonEl.style.display =\n",
              "        google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "      async function convertToInteractive(key) {\n",
              "        const element = document.querySelector('#df-3efc29f4-49dc-483c-ab07-1d7099b065e0');\n",
              "        const dataTable =\n",
              "          await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                    [key], {});\n",
              "        if (!dataTable) return;\n",
              "\n",
              "        const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "          + ' to learn more about interactive tables.';\n",
              "        element.innerHTML = '';\n",
              "        dataTable['output_type'] = 'display_data';\n",
              "        await google.colab.output.renderOutput(dataTable, element);\n",
              "        const docLink = document.createElement('div');\n",
              "        docLink.innerHTML = docLinkHtml;\n",
              "        element.appendChild(docLink);\n",
              "      }\n",
              "    </script>\n",
              "  </div>\n",
              "\n",
              "\n",
              "    <div id=\"df-90c593b4-f548-43ca-90c4-9aa56ba6a8d5\">\n",
              "      <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-90c593b4-f548-43ca-90c4-9aa56ba6a8d5')\"\n",
              "                title=\"Suggest charts\"\n",
              "                style=\"display:none;\">\n",
              "\n",
              "<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "     width=\"24px\">\n",
              "    <g>\n",
              "        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n",
              "    </g>\n",
              "</svg>\n",
              "      </button>\n",
              "\n",
              "<style>\n",
              "  .colab-df-quickchart {\n",
              "      --bg-color: #E8F0FE;\n",
              "      --fill-color: #1967D2;\n",
              "      --hover-bg-color: #E2EBFA;\n",
              "      --hover-fill-color: #174EA6;\n",
              "      --disabled-fill-color: #AAA;\n",
              "      --disabled-bg-color: #DDD;\n",
              "  }\n",
              "\n",
              "  [theme=dark] .colab-df-quickchart {\n",
              "      --bg-color: #3B4455;\n",
              "      --fill-color: #D2E3FC;\n",
              "      --hover-bg-color: #434B5C;\n",
              "      --hover-fill-color: #FFFFFF;\n",
              "      --disabled-bg-color: #3B4455;\n",
              "      --disabled-fill-color: #666;\n",
              "  }\n",
              "\n",
              "  .colab-df-quickchart {\n",
              "    background-color: var(--bg-color);\n",
              "    border: none;\n",
              "    border-radius: 50%;\n",
              "    cursor: pointer;\n",
              "    display: none;\n",
              "    fill: var(--fill-color);\n",
              "    height: 32px;\n",
              "    padding: 0;\n",
              "    width: 32px;\n",
              "  }\n",
              "\n",
              "  .colab-df-quickchart:hover {\n",
              "    background-color: var(--hover-bg-color);\n",
              "    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "    fill: var(--button-hover-fill-color);\n",
              "  }\n",
              "\n",
              "  .colab-df-quickchart-complete:disabled,\n",
              "  .colab-df-quickchart-complete:disabled:hover {\n",
              "    background-color: var(--disabled-bg-color);\n",
              "    fill: var(--disabled-fill-color);\n",
              "    box-shadow: none;\n",
              "  }\n",
              "\n",
              "  .colab-df-spinner {\n",
              "    border: 2px solid var(--fill-color);\n",
              "    border-color: transparent;\n",
              "    border-bottom-color: var(--fill-color);\n",
              "    animation:\n",
              "      spin 1s steps(1) infinite;\n",
              "  }\n",
              "\n",
              "  @keyframes spin {\n",
              "    0% {\n",
              "      border-color: transparent;\n",
              "      border-bottom-color: var(--fill-color);\n",
              "      border-left-color: var(--fill-color);\n",
              "    }\n",
              "    20% {\n",
              "      border-color: transparent;\n",
              "      border-left-color: var(--fill-color);\n",
              "      border-top-color: var(--fill-color);\n",
              "    }\n",
              "    30% {\n",
              "      border-color: transparent;\n",
              "      border-left-color: var(--fill-color);\n",
              "      border-top-color: var(--fill-color);\n",
              "      border-right-color: var(--fill-color);\n",
              "    }\n",
              "    40% {\n",
              "      border-color: transparent;\n",
              "      border-right-color: var(--fill-color);\n",
              "      border-top-color: var(--fill-color);\n",
              "    }\n",
              "    60% {\n",
              "      border-color: transparent;\n",
              "      border-right-color: var(--fill-color);\n",
              "    }\n",
              "    80% {\n",
              "      border-color: transparent;\n",
              "      border-right-color: var(--fill-color);\n",
              "      border-bottom-color: var(--fill-color);\n",
              "    }\n",
              "    90% {\n",
              "      border-color: transparent;\n",
              "      border-bottom-color: var(--fill-color);\n",
              "    }\n",
              "  }\n",
              "</style>\n",
              "\n",
              "      <script>\n",
              "        async function quickchart(key) {\n",
              "          const quickchartButtonEl =\n",
              "            document.querySelector('#' + key + ' button');\n",
              "          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n",
              "          quickchartButtonEl.classList.add('colab-df-spinner');\n",
              "          try {\n",
              "            const charts = await google.colab.kernel.invokeFunction(\n",
              "                'suggestCharts', [key], {});\n",
              "          } catch (error) {\n",
              "            console.error('Error during call to suggestCharts:', error);\n",
              "          }\n",
              "          quickchartButtonEl.classList.remove('colab-df-spinner');\n",
              "          quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n",
              "        }\n",
              "        (() => {\n",
              "          let quickchartButtonEl =\n",
              "            document.querySelector('#df-90c593b4-f548-43ca-90c4-9aa56ba6a8d5 button');\n",
              "          quickchartButtonEl.style.display =\n",
              "            google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "        })();\n",
              "      </script>\n",
              "    </div>\n",
              "\n",
              "    </div>\n",
              "  </div>\n"
            ],
            "application/vnd.google.colaboratory.intrinsic+json": {
              "type": "dataframe",
              "variable_name": "df"
            }
          },
          "metadata": {},
          "execution_count": 11
        }
      ],
      "source": [
        "pd.set_option('display.max_columns', None)\n",
        "print(df.columns)\n",
        "print(len(df))\n",
        "df.head()"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Manual Vectorizer Creation --IGNORE--"
      ],
      "metadata": {
        "id": "qhcxLPBnoAHp"
      },
      "id": "qhcxLPBnoAHp"
    },
    {
      "cell_type": "markdown",
      "source": [
        "Vectorization does work if you do it from scratch, however it does not save to the joblib file properly for some reason. This is not the preferred way to make a sparse matrix since Karl has provided a vectorizationn object that does work with claims text"
      ],
      "metadata": {
        "id": "Ii0KLPiochk5"
      },
      "id": "Ii0KLPiochk5"
    },
    {
      "cell_type": "code",
      "execution_count": 12,
      "id": "42f32687",
      "metadata": {
        "id": "42f32687"
      },
      "outputs": [],
      "source": [
        "import joblib\n",
        "from sklearn.feature_extraction.text import TfidfVectorizer\n",
        "\n",
        "# tfidf_features = joblib.load('./tfidf_features.joblib')\n",
        "# tlidf_vectorizer = joblib.load('./tfidf_vectorizer.joblib')\n",
        "\n",
        "# suppose texts is a NumPy array (or list) of token lists\n",
        "# e.g. [['novel', 'catalyst'], ['apparatus', 'for', '...'], ...]\n",
        "\n",
        "def identity(tokens):\n",
        "    return tokens\n",
        "\n",
        "tlidf_vectorizer = TfidfVectorizer(\n",
        "    analyzer=identity,     # accept pre-tokenized lists\n",
        "    lowercase=False,       # tokens already normalized\n",
        "    dtype=float,\n",
        "    norm=\"l2\"\n",
        ")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 13,
      "id": "db5be850",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "db5be850",
        "outputId": "56493bcf-2809-429e-9ad5-0b6b3a753459"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Creating vocabulary...\n",
            "Vocabulary created with 637,906 unique tokens\n"
          ]
        },
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py:2043: UserWarning: Only (<class 'numpy.float64'>, <class 'numpy.float32'>, <class 'numpy.float16'>) 'dtype' should be used. <class 'float'> 'dtype' will be converted to np.float64.\n",
            "  warnings.warn(\n"
          ]
        }
      ],
      "source": [
        "import nltk\n",
        "from sklearn.feature_extraction.text import TfidfVectorizer\n",
        "\n",
        "def build_vocabulary(input_df):\n",
        "    #This builds a vocabulary based on the tokens in the claim_text column\n",
        "    #it saves the vocabulary to whatever you put in output_vocab_file which should be a .json file\n",
        "\n",
        "    vocab = set()\n",
        "\n",
        "    reader = input_df['claim_text']\n",
        "    print('Creating vocabulary...')\n",
        "    for token_list in reader:\n",
        "        vocab.update(token_list)\n",
        "    print(f\"Vocabulary created with {len(vocab):,} unique tokens\")\n",
        "\n",
        "    # Convert set to sorted list for stable saving\n",
        "    vocab_list = sorted(vocab)\n",
        "\n",
        "    return vocab_list\n",
        "\n",
        "def build_claim_vectorizer(vocab):\n",
        "    \"\"\"Return a TF-IDF vectorizer with the same settings as fit_tfidf_vectorizer.\"\"\"\n",
        "    vectorizer = TfidfVectorizer(\n",
        "        vocabulary={tok: i for i, tok in enumerate(vocab)},\n",
        "        analyzer=lambda tokens: tokens,   # accept pre-tokenized lists\n",
        "        lowercase=False,\n",
        "        norm=\"l2\",\n",
        "        dtype=float,\n",
        "        use_idf=True,\n",
        "\n",
        "    )\n",
        "    return vectorizer\n",
        "\n",
        "# usage\n",
        "# df['claim_text'] is a column of lists, e.g. ['apparatus', 'comprising', ...]\n",
        "\n",
        "vocab_list = build_vocabulary(df)\n",
        "vectorizer = build_claim_vectorizer(vocab_list)\n",
        "sparse_matrix = vectorizer.fit_transform(df['claim_text'])"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "982a04b9",
      "metadata": {
        "id": "982a04b9"
      },
      "outputs": [],
      "source": [
        "from scipy import sparse\n",
        "num_docs = len(df['claim_text'])\n",
        "token_to_idx = vectorizer.vocabulary_\n",
        "df_counts = np.zeros(len(token_to_idx), dtype=np.int64)\n",
        "\n",
        "for tokens in df['claim_text']:\n",
        "    for tok in set(tokens):\n",
        "        idx = token_to_idx.get(tok)\n",
        "        if idx is not None:\n",
        "            df_counts[idx] += 1\n",
        "\n",
        "\n",
        "idf = np.log((1 + num_docs) / (1 + df_counts)) + 1.0\n",
        "vectorizer.idf_ = idf\n",
        "vectorizer._tfidf._idf_diag = sparse.spdiags(idf, diags=0, m=len(idf), n=len(idf))\n",
        "joblib.dump(vectorizer, './tfidf_vectorizer_v2.joblib')\n"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Vectorizer Loading -- DONT IGNORE --"
      ],
      "metadata": {
        "id": "WXbA3SCMoIPs"
      },
      "id": "WXbA3SCMoIPs"
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "c4c1ed60",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 532
        },
        "id": "c4c1ed60",
        "outputId": "ce304bea-4beb-4cc3-cde7-443b835c7eb3"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "loading tfidf_vectorizer...\n",
            "finished loading vectorizer, now creating sparse matrix\n"
          ]
        },
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py:2043: UserWarning: Only (<class 'numpy.float64'>, <class 'numpy.float32'>, <class 'numpy.float16'>) 'dtype' should be used. <class 'float'> 'dtype' will be converted to np.float64.\n",
            "  warnings.warn(\n",
            "/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py:517: UserWarning: The parameter 'token_pattern' will not be used since 'tokenizer' is not None'\n",
            "  warnings.warn(\n"
          ]
        },
        {
          "output_type": "error",
          "ename": "TypeError",
          "evalue": "descriptor 'split' for 'str' objects doesn't apply to a 'list' object",
          "traceback": [
            "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
            "\u001b[0;31mTypeError\u001b[0m                                 Traceback (most recent call last)",
            "\u001b[0;32m/tmp/ipython-input-3785962432.py\u001b[0m in \u001b[0;36m<cell line: 0>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0mtlidf_vectorizer\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mjoblib\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mload\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'/content/drive/MyDrive/final combined data/tfidf_vectorizer_for_bryant.joblib'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"finished loading vectorizer, now creating sparse matrix\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 6\u001b[0;31m \u001b[0msparse_matrix\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtlidf_vectorizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfit_transform\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m'claim_text'\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      7\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      8\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;32m/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py\u001b[0m in \u001b[0;36mfit_transform\u001b[0;34m(self, raw_documents, y)\u001b[0m\n\u001b[1;32m   2102\u001b[0m             \u001b[0msublinear_tf\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msublinear_tf\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   2103\u001b[0m         )\n\u001b[0;32m-> 2104\u001b[0;31m         \u001b[0mX\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0msuper\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfit_transform\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mraw_documents\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   2105\u001b[0m         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_tfidf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mX\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   2106\u001b[0m         \u001b[0;31m# X is already a transformed view of raw_documents so\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;32m/usr/local/lib/python3.12/dist-packages/sklearn/base.py\u001b[0m in \u001b[0;36mwrapper\u001b[0;34m(estimator, *args, **kwargs)\u001b[0m\n\u001b[1;32m   1387\u001b[0m                 )\n\u001b[1;32m   1388\u001b[0m             ):\n\u001b[0;32m-> 1389\u001b[0;31m                 \u001b[0;32mreturn\u001b[0m \u001b[0mfit_method\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mestimator\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwargs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1390\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1391\u001b[0m         \u001b[0;32mreturn\u001b[0m \u001b[0mwrapper\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;32m/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py\u001b[0m in \u001b[0;36mfit_transform\u001b[0;34m(self, raw_documents, y)\u001b[0m\n\u001b[1;32m   1374\u001b[0m                     \u001b[0;32mbreak\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1375\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1376\u001b[0;31m         \u001b[0mvocabulary\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mX\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_count_vocab\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mraw_documents\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfixed_vocabulary_\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1377\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1378\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbinary\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;32m/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py\u001b[0m in \u001b[0;36m_count_vocab\u001b[0;34m(self, raw_documents, fixed_vocab)\u001b[0m\n\u001b[1;32m   1261\u001b[0m         \u001b[0;32mfor\u001b[0m \u001b[0mdoc\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mraw_documents\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1262\u001b[0m             \u001b[0mfeature_counter\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m{\u001b[0m\u001b[0;34m}\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1263\u001b[0;31m             \u001b[0;32mfor\u001b[0m \u001b[0mfeature\u001b[0m \u001b[0;32min\u001b[0m \u001b[0manalyze\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdoc\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1264\u001b[0m                 \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1265\u001b[0m                     \u001b[0mfeature_idx\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mvocabulary\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mfeature\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;32m/usr/local/lib/python3.12/dist-packages/sklearn/feature_extraction/text.py\u001b[0m in \u001b[0;36m_analyze\u001b[0;34m(doc, analyzer, tokenizer, ngrams, preprocessor, decoder, stop_words)\u001b[0m\n\u001b[1;32m    104\u001b[0m             \u001b[0mdoc\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mpreprocessor\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdoc\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    105\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mtokenizer\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 106\u001b[0;31m             \u001b[0mdoc\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtokenizer\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdoc\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    107\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mngrams\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    108\u001b[0m             \u001b[0;32mif\u001b[0m \u001b[0mstop_words\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;31mTypeError\u001b[0m: descriptor 'split' for 'str' objects doesn't apply to a 'list' object"
          ]
        }
      ],
      "source": [
        "import joblib\n",
        "# sparse_matrix = tlidf_vectorizer.transform(df['claim_text'])\n",
        "print(\"loading tfidf_vectorizer...\")\n",
        "tlidf_vectorizer = joblib.load('/content/drive/MyDrive/final combined data/tfidf_vectorizer_for_bryant.joblib')\n",
        "print(\"finished loading vectorizer, now creating sparse matrix\")\n",
        "sparse_matrix = tlidf_vectorizer.fit_transform(df['claim_text'])\n",
        "\n",
        "\n"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### SVD of tfidf matrix, Creation of X data and Y data for train-test-split"
      ],
      "metadata": {
        "id": "0_eEY_godKTs"
      },
      "id": "0_eEY_godKTs"
    },
    {
      "cell_type": "code",
      "execution_count": 14,
      "id": "186497d9",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "186497d9",
        "outputId": "be7751a8-2ec4-40de-c581-482774e90c9d"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(3909923, 637906)"
            ]
          },
          "metadata": {},
          "execution_count": 14
        }
      ],
      "source": [
        "from sklearn.decomposition import TruncatedSVD\n",
        "num_dimensions = 100\n",
        "svd = TruncatedSVD(\n",
        "    n_components=num_dimensions,\n",
        "    n_iter=7,\n",
        "    random_state=70\n",
        ")\n",
        "sparse_matrix.shape\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 15,
      "id": "a7187a41",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "a7187a41",
        "outputId": "7b7cbf3e-2dde-4e33-e503-facc11ab8f73"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Performing TruncatedSVD with 100 components...\n"
          ]
        }
      ],
      "source": [
        "from scipy.sparse import csr_matrix\n",
        "from scipy.sparse import hstack\n",
        "\n",
        "extra_np = (\n",
        "    df.drop(columns=['claim_text', 'application_number', 'y_approved', 'y_101', 'y_102', 'y_103', 'y_112'])\n",
        "    .apply(pd.to_numeric, errors=\"coerce\")  # convert strings/bools -> numbers\n",
        "    .fillna(0)                              # replace NaNs\n",
        "    .to_numpy(dtype=np.float64)             # ensure a numeric dtype\n",
        ")\n",
        "\n",
        "extra_sparse = csr_matrix(extra_np)\n",
        "print(f\"Performing TruncatedSVD with {num_dimensions} components...\")\n",
        "tfidf_svd = svd.fit_transform(sparse_matrix)\n",
        "\n",
        "X_aug_combined = hstack([tfidf_svd, extra_sparse])\n",
        "X_aug_no_tfidf = extra_sparse\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 16,
      "id": "9803b375",
      "metadata": {
        "id": "9803b375"
      },
      "outputs": [],
      "source": [
        "y_rejected = df['y_approved'] == 0\n",
        "y_rejected = y_rejected.astype(int)\n",
        "y_has_rej101 = df['y_101']\n",
        "y_has_rej102 = df['y_102']\n",
        "y_has_rej103 = df['y_103']\n",
        "y_has_rej112 = df['y_112']"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Train test split of all data"
      ],
      "metadata": {
        "id": "FRiDi6fMdY9X"
      },
      "id": "FRiDi6fMdY9X"
    },
    {
      "cell_type": "markdown",
      "source": [
        "Below is train test split of data without tfidf sparse matrix"
      ],
      "metadata": {
        "id": "QYfCpTfcddtX"
      },
      "id": "QYfCpTfcddtX"
    },
    {
      "cell_type": "code",
      "execution_count": 18,
      "id": "1352626a",
      "metadata": {
        "id": "1352626a"
      },
      "outputs": [],
      "source": [
        "#  getting train and test data for data with no tfidf\n",
        "from sklearn.model_selection import train_test_split\n",
        "X_train_rejected_no_tfidf, X_test_rejected_no_tfidf, y_train_rejected_no_tfidf, y_test_rejected_no_tfidf = train_test_split(X_aug_no_tfidf, y_rejected, test_size=0.2, random_state=42)\n",
        "X_train_has_rej101_no_tfidf, X_test_has_rej101_no_tfidf, y_train_has_rej101_no_tfidf, y_test_has_rej101_no_tfidf = train_test_split(X_aug_no_tfidf, y_has_rej101, test_size=0.2, random_state=42)\n",
        "X_train_has_rej102_no_tfidf, X_test_has_rej102_no_tfidf, y_train_has_rej102_no_tfidf, y_test_has_rej102_no_tfidf = train_test_split(X_aug_no_tfidf, y_has_rej102, test_size=0.2, random_state=42)\n",
        "X_train_has_rej103_no_tfidf, X_test_has_rej103_no_tfidf, y_train_has_rej103_no_tfidf, y_test_has_rej103_no_tfidf = train_test_split(X_aug_no_tfidf, y_has_rej103, test_size=0.2, random_state=42)\n",
        "X_train_has_rej112_no_tfidf, X_test_has_rej112_no_tfidf, y_train_has_rej112_no_tfidf, y_test_has_rej112_no_tfidf = train_test_split(X_aug_no_tfidf, y_has_rej112, test_size=0.2, random_state=42)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 19,
      "id": "090d1288",
      "metadata": {
        "id": "090d1288"
      },
      "outputs": [],
      "source": [
        "#  getting train and test data for data with tfidf\n",
        "from sklearn.model_selection import train_test_split\n",
        "\n",
        "X_train_rejected, X_test_rejected, y_train_rejected, y_test_rejected = train_test_split(X_aug_combined, y_rejected, test_size=0.2, random_state=42)\n",
        "X_train_has_rej101, X_test_has_rej101, y_train_has_rej101, y_test_has_rej101 = train_test_split(X_aug_combined, y_has_rej101, test_size=0.2, random_state=42)\n",
        "X_train_has_rej102, X_test_has_rej102, y_train_has_rej102, y_test_has_rej102 = train_test_split(X_aug_combined, y_has_rej102, test_size=0.2, random_state=42)\n",
        "X_train_has_rej103, X_test_has_rej103, y_train_has_rej103, y_test_has_rej103 = train_test_split(X_aug_combined, y_has_rej103, test_size=0.2, random_state=42)\n",
        "X_train_has_rej112, X_test_has_rej112, y_train_has_rej112, y_test_has_rej112 = train_test_split(X_aug_combined, y_has_rej112, test_size=0.2, random_state=42)"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "dataset_organization = {\n",
        "    \"Overall Rejection, all features\": (X_train_rejected, X_test_rejected, y_train_rejected, y_test_rejected),\n",
        "    \"101 Rejection, all features\": (X_train_has_rej101, X_test_has_rej101, y_train_has_rej101, y_test_has_rej101),\n",
        "    \"102 Rejection, all features\": (X_train_has_rej102, X_test_has_rej102, y_train_has_rej102, y_test_has_rej102),\n",
        "    \"103 Rejection, all features\": (X_train_has_rej103, X_test_has_rej103, y_train_has_rej103, y_test_has_rej103),\n",
        "    \"112 Rejection, all features\": (X_train_has_rej112, X_test_has_rej112, y_train_has_rej112, y_test_has_rej112),\n",
        "    \"Overall Rejections, no tfidf\": (X_train_rejected_no_tfidf, X_test_rejected_no_tfidf, y_train_rejected_no_tfidf, y_test_rejected_no_tfidf),\n",
        "    \"101 Rejections, no tfidf\": (X_train_has_rej101_no_tfidf, X_test_has_rej101_no_tfidf, y_train_has_rej101_no_tfidf, y_test_has_rej101_no_tfidf),\n",
        "    \"102 Rejections, no tfidf\": (X_train_has_rej102_no_tfidf, X_test_has_rej102_no_tfidf, y_train_has_rej102_no_tfidf, y_test_has_rej102_no_tfidf),\n",
        "    \"103 Rejections, no tfidf\": (X_train_has_rej103_no_tfidf, X_test_has_rej103_no_tfidf, y_train_has_rej103_no_tfidf, y_test_has_rej103_no_tfidf),\n",
        "    \"112 Rejections, no tfidf\": (X_train_has_rej112_no_tfidf, X_test_has_rej112_no_tfidf, y_train_has_rej112_no_tfidf, y_test_has_rej112_no_tfidf)\n",
        "}"
      ],
      "metadata": {
        "id": "q1AIB7pxu9Pk"
      },
      "id": "q1AIB7pxu9Pk",
      "execution_count": 20,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Modeling"
      ],
      "metadata": {
        "id": "vdSmLvX1donA"
      },
      "id": "vdSmLvX1donA"
    },
    {
      "cell_type": "markdown",
      "source": [],
      "metadata": {
        "id": "Fi0r3FXAu8Z8"
      },
      "id": "Fi0r3FXAu8Z8"
    },
    {
      "cell_type": "code",
      "source": [
        "from sklearn.linear_model import LogisticRegression\n",
        "from sklearn.linear_model import LinearRegression\n",
        "from sklearn.ensemble import RandomForestClassifier\n",
        "from sklearn.ensemble import GradientBoostingClassifier\n",
        "from xgboost import XGBClassifier\n",
        "from sklearn.ensemble import GradientBoostingClassifier, RandomForestClassifier\n",
        "from sklearn.model_selection import RandomizedSearchCV, GridSearchCV"
      ],
      "metadata": {
        "id": "wyjCc5LZ9-6H"
      },
      "id": "wyjCc5LZ9-6H",
      "execution_count": 21,
      "outputs": []
    },
    {
      "cell_type": "code",
      "execution_count": 22,
      "id": "caa4919c",
      "metadata": {
        "id": "caa4919c"
      },
      "outputs": [],
      "source": [
        "def get_best_random_gb_params(X_train, y_train, scoring = 'f1', n_iter = 20):\n",
        "    gb = XGBClassifier(random_state=0)\n",
        "    gb_space = {\n",
        "        \"n_estimators\": np.arange(50, 401),\n",
        "        \"learning_rate\": np.logspace(-3, 0, 100),\n",
        "        \"max_depth\": np.arange(1, 6),\n",
        "        \"min_samples_split\": np.arange(2, 21),\n",
        "    }\n",
        "    gb_rand = RandomizedSearchCV(\n",
        "        gb,\n",
        "        gb_space,\n",
        "        n_iter=n_iter,\n",
        "        scoring=scoring,\n",
        "        cv=5,\n",
        "        random_state=0,\n",
        "        n_jobs=-1,\n",
        "    )\n",
        "    gb_rand.fit(X_train, y_train)\n",
        "    gb_best = gb_rand.best_params_\n",
        "    return gb_best\n",
        "\n",
        "def get_best_random_rf_params(X_train, y_train, scoring = 'f1', n_iter = 20):\n",
        "    rf = RandomForestClassifier(random_state=0)\n",
        "    rf_space = {\n",
        "        \"n_estimators\": np.arange(100, 801),\n",
        "        \"max_depth\": [None, *np.arange(5, 31)],\n",
        "        \"min_samples_split\": np.arange(2, 21),\n",
        "        \"min_samples_leaf\": np.arange(1, 11),\n",
        "        \"max_features\": [\"sqrt\", \"log2\", 0.5, None],\n",
        "    }\n",
        "    rf_rand = RandomizedSearchCV(\n",
        "        rf,\n",
        "        rf_space,\n",
        "        n_iter=n_iter,\n",
        "        scoring=scoring,\n",
        "        cv=5,\n",
        "        random_state=0,\n",
        "        n_jobs=-1,\n",
        "    )\n",
        "    rf_rand.fit(X_train, y_train)\n",
        "    rf_best = rf_rand.best_params_\n",
        "    return rf_best\n",
        "\n",
        "def get_best_grid_search_gb_model(X_train, y_train, gb_best, scoring = 'f1'):\n",
        "    gb_grid = {\n",
        "        \"n_estimators\": [gb_best[\"n_estimators\"] - 50,\n",
        "                        gb_best[\"n_estimators\"],\n",
        "                        gb_best[\"n_estimators\"] + 50],\n",
        "        \"learning_rate\": [gb_best[\"learning_rate\"] * f for f in [0.5, 1.0, 1.5]],\n",
        "        \"max_depth\": [gb_best[\"max_depth\"]],\n",
        "        \"min_samples_split\": [gb_best[\"min_samples_split\"] - 1,\n",
        "                            gb_best[\"min_samples_split\"],\n",
        "                            gb_best[\"min_samples_split\"] + 1],\n",
        "    }\n",
        "    gb_grid = {k: [v] if not isinstance(v, list) else v for k, v in gb_grid.items()}\n",
        "    gb_grid = {k: [val for val in vals if val is not None and val > 0] for k, vals in gb_grid.items()}\n",
        "    gb_gridsearch = GridSearchCV(\n",
        "        GradientBoostingClassifier(random_state=0),\n",
        "        gb_grid,\n",
        "        scoring=scoring,\n",
        "        cv=5,\n",
        "        n_jobs=-1,\n",
        "    )\n",
        "    return gb_gridsearch\n",
        "\n",
        "def get_best_grid_search_rf_model(X_train, y_train, rf_best, scoring = 'f1'):\n",
        "    rf_grid = {\n",
        "        \"n_estimators\": [rf_best[\"n_estimators\"] - 100,\n",
        "                        rf_best[\"n_estimators\"],\n",
        "                        rf_best[\"n_estimators\"] + 100],\n",
        "        \"max_depth\": [None if rf_best[\"max_depth\"] is None else d for d in [\n",
        "            rf_best[\"max_depth\"] - 5,\n",
        "            rf_best[\"max_depth\"],\n",
        "            rf_best[\"max_depth\"] + 5,\n",
        "        ] if d is None or d > 0],\n",
        "        \"min_samples_split\": [max(2, rf_best[\"min_samples_split\"] - 1),\n",
        "                            rf_best[\"min_samples_split\"],\n",
        "                            rf_best[\"min_samples_split\"] + 1],\n",
        "        \"min_samples_leaf\": [max(1, rf_best[\"min_samples_leaf\"] - 1),\n",
        "                            rf_best[\"min_samples_leaf\"],\n",
        "                            rf_best[\"min_samples_leaf\"] + 1],\n",
        "        \"max_features\": [rf_best[\"max_features\"]],\n",
        "    }\n",
        "    rf_grid = {k: [v] if not isinstance(v, list) else v for k, v in rf_grid.items()}\n",
        "    rf_grid = {k: [val for val in vals if val is not None] for k, vals in rf_grid.items()}\n",
        "    rf_gridsearch = GridSearchCV(\n",
        "        RandomForestClassifier(random_state=0),\n",
        "        rf_grid,\n",
        "        scoring=scoring,\n",
        "        cv=5,\n",
        "        n_jobs=-1,\n",
        "    )\n",
        "    return rf_gridsearch"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 63,
      "id": "c0c9fe10",
      "metadata": {
        "id": "c0c9fe10"
      },
      "outputs": [],
      "source": [
        "from sklearn.linear_model import LogisticRegression\n",
        "from sklearn.linear_model import LinearRegression\n",
        "from sklearn.ensemble import RandomForestClassifier\n",
        "from sklearn.ensemble import GradientBoostingClassifier\n",
        "from xgboost import XGBClassifier\n",
        "import lightgbm as lgb\n",
        "import time\n",
        "\n",
        "def create_models(X_train, y_train, X_train_gpu = None,rf_params = None, gb_params = None):\n",
        "    models = {}\n",
        "    models['LogR'] = LogisticRegression(solver='saga', max_iter=5000)\n",
        "    models['LinR'] = LinearRegression()\n",
        "    if rf_params:\n",
        "        models['RF'] = RandomForestClassifier(**rf_params)\n",
        "    else:\n",
        "        models['RF'] = RandomForestClassifier(n_estimators=100)\n",
        "    if gb_params:\n",
        "        models['GB'] = lgb.LGBMClassifier(**gb_params)\n",
        "    else:\n",
        "        models['GB'] = lgb.LGBMClassifier(objective='binary', metric=[\"binary_logloss\", \"auc\"], learning_rate=.05,\n",
        "                                          num_leaves=64, max_depth=-1, feature_fraction=0.8, bagging_fraction=0.8,\n",
        "                                          bagging_freq=4, min_data_in_leaf=50, verbosity=-1, boosting_type='gbdt'\n",
        "                                          )\n",
        "    print(\"Fitting Logistic Regression\")\n",
        "    start_time = time.time()\n",
        "    models['LogR'].fit(X_train, y_train)\n",
        "    end_time = time.time()\n",
        "    print(f\"Logistic Regression training time: {end_time - start_time} seconds\")\n",
        "    print(\"Fitting Linear Regression\")\n",
        "    start_time = time.time()\n",
        "    models['LinR'].fit(X_train, y_train)\n",
        "    end_time = time.time()\n",
        "    print(f\"Linear Regression training time: {end_time - start_time} seconds\")\n",
        "\n",
        "    if X_train_gpu is not None:\n",
        "      print(\"Fitting Random Forest with Dense GPU Training Data\")\n",
        "      start_time = time.time()\n",
        "      models['RF'].fit(X_train_gpu, y_train)\n",
        "      end_time = time.time()\n",
        "      print(f\"Random Forest training time: {end_time - start_time} seconds\")\n",
        "\n",
        "    else:\n",
        "      print(\"Fitting Random Forest\")\n",
        "      start_time = time.time()\n",
        "      models['RF'].fit(X_train, y_train)\n",
        "      end_time = time.time()\n",
        "      print(f\"Random Forest training time: {end_time - start_time} seconds\")\n",
        "\n",
        "    print(\"Fitting Gradient Boosting with Dense GPU Training Data\")\n",
        "    start_time = time.time()\n",
        "    models['GB'].fit(X_train, y_train)\n",
        "    end_time = time.time()\n",
        "    print(f\"Gradient Boosting training time: {end_time - start_time} seconds\")\n",
        "    return models"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "39bc5ed9",
      "metadata": {
        "id": "39bc5ed9"
      },
      "outputs": [],
      "source": [
        "# Fill in below with the right data, currently filled in for overall rejections using X values with no tfidf data\n",
        "X_train = X_train_rejected_no_tfidf\n",
        "y_train = y_train_rejected_no_tfidf\n",
        "X_test = X_test_rejected_no_tfidf\n",
        "y_test = y_test_rejected_no_tfidf"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "import cupy as cp\n",
        "print(\"Converting training data to dense array for GPU...\")\n",
        "start_time = time.time()\n",
        "X_train_dense_gpu = cp.asarray(X_train.todense())\n",
        "end_time = time.time()\n",
        "print(f\"Conversion time: {end_time - start_time} seconds\")\n",
        "print(\"Converting testing data to dense array for GPU\")\n",
        "start_time = time.time()\n",
        "X_test_dense_gpu = cp.asarray(X_train.todense())\n",
        "end_time = time.time()\n",
        "print(f\"Conversion time: {end_time - start_time} seconds\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "FJK3ILiVvB6B",
        "outputId": "3efe0bc8-4590-4135-ed4a-255ab1ffc049"
      },
      "id": "FJK3ILiVvB6B",
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Converting training data to dense array for GPU...\n",
            "Conversion time: 9.7493257522583 seconds\n",
            "Converting testing data to dense array for GPU\n",
            "Conversion time: 6.132742404937744 seconds\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "numeric_df = df.drop(columns=['claim_text', 'application_number', 'y_approved', 'y_101', 'y_102', 'y_103', 'y_112'])\n",
        "model = models[\"LogR\"]"
      ],
      "metadata": {
        "id": "f2Hbq6KSlvsP"
      },
      "id": "f2Hbq6KSlvsP",
      "execution_count": 50,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "\n",
        "def importance_info(model, model_type, numeric_df, num_tfidf_vectors=100, top_n_features = 10, no_tfidf = False):\n",
        "  if model_type == \"LogR\":\n",
        "    importances = np.abs(model.coef_[0])\n",
        "  elif model_type == \"LinR\":\n",
        "    importances = np.abs(model.coef_)\n",
        "  elif model_type == \"RF\":\n",
        "    importances = cp.asnumpy(model.feature_importances_)\n",
        "  else:\n",
        "    importances = model.feature_importances_  # or np.abs(model.coef_[0]) for logistic\n",
        "\n",
        "\n",
        "  # Create feature names\n",
        "  tfidf_feature_names = [f'tfidf_component_{i}' for i in range(num_tfidf_vectors)]\n",
        "  numeric_feature_names = numeric_df.columns.tolist()\n",
        "  if no_tfidf:\n",
        "    all_feature_names = numeric_feature_names\n",
        "  else:\n",
        "    all_feature_names = tfidf_feature_names + numeric_feature_names\n",
        "\n",
        "  # Create importance DataFrame\n",
        "  feature_importance = pd.DataFrame({\n",
        "      'feature': all_feature_names,\n",
        "      'importance': importances\n",
        "  })\n",
        "\n",
        "  # Sort by importance\n",
        "  top_features = feature_importance.sort_values('importance', ascending=False)\n",
        "  print(top_features.head(top_n_features * 2))\n",
        "\n",
        "  # Separate TF-IDF vs numeric features\n",
        "  if not no_tfidf:\n",
        "    print(\"\\nTop TF-IDF components:\")\n",
        "    tfidf_importance = feature_importance.iloc[:num_tfidf_vectors].sort_values('importance', ascending=False)\n",
        "    print(tfidf_importance.head(top_n_features))\n",
        "\n",
        "    print(\"\\nTop Numeric features:\")\n",
        "    numeric_importance = feature_importance.iloc[num_tfidf_vectors:].sort_values('importance', ascending=False)\n",
        "    print(numeric_importance.head(top_n_features))\n",
        "# importance_info(model, \"LogR\", numeric_df)"
      ],
      "metadata": {
        "id": "OHAUWGKvp3YD"
      },
      "id": "OHAUWGKvp3YD",
      "execution_count": 60,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "dataset_organization.keys()"
      ],
      "metadata": {
        "id": "3wSX7pZFt5zK",
        "outputId": "a3388aa1-3e7c-4799-e2a8-288d4f3f70d6",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "id": "3wSX7pZFt5zK",
      "execution_count": 61,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "dict_keys(['Overall Rejection, all features', '101 Rejection, all features', '102 Rejection, all features', '103 Rejection, all features', '112 Rejection, all features', 'Overall Rejections, no tfidf', '101 Rejections, no tfidf', '102 Rejections, no tfidf', '103 Rejections, no tfidf', '112 Rejections, no tfidf'])"
            ]
          },
          "metadata": {},
          "execution_count": 61
        }
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 72,
      "id": "3113d159",
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "3113d159",
        "outputId": "f0388bc2-d605-4eda-a3af-5dee72e85706"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "----------------------------\n",
            "112 Rejections, no tfidf\n",
            "----------------------------\n",
            "Converting training data to dense array for GPU...\n",
            "Conversion time: 6.56776237487793 seconds\n",
            "Converting testing data to dense array for GPU\n",
            "Conversion time: 1.6666584014892578 seconds\n",
            "Fitting Logistic Regression\n",
            "Logistic Regression training time: 2.1190640926361084 seconds\n",
            "Fitting Linear Regression\n",
            "Linear Regression training time: 1.7703814506530762 seconds\n",
            "Fitting Random Forest with Dense GPU Training Data\n",
            "Random Forest training time: 15.819611310958862 seconds\n",
            "Fitting Gradient Boosting with Dense GPU Training Data\n",
            "Gradient Boosting training time: 13.837222814559937 seconds\n",
            "Model: LogR\n",
            "              precision    recall  f1-score   support\n",
            "\n",
            "           0       0.66      0.67      0.66    400461\n",
            "           1       0.65      0.64      0.64    381524\n",
            "\n",
            "    accuracy                           0.65    781985\n",
            "   macro avg       0.65      0.65      0.65    781985\n",
            "weighted avg       0.65      0.65      0.65    781985\n",
            "\n",
            "                                               feature  importance\n",
            "210  art_unit_cat_Semiconductors/Memory, Circuits/M...    0.884670\n",
            "3                              aia_first_to_file_False    0.702676\n",
            "2                             entity_size_UNDISCOUNTED    0.666772\n",
            "202         art_unit_cat_Biotech and Organic Chemistry    0.614084\n",
            "203    art_unit_cat_Chemical and Materials Engineering    0.564632\n",
            "201                                         country_na    0.481048\n",
            "204                        art_unit_cat_Communications    0.459090\n",
            "208  art_unit_cat_Networking, Multiplexing, Cable, ...    0.291726\n",
            "187                                         country_US    0.286575\n",
            "1                                    entity_size_SMALL    0.284770\n",
            "211  art_unit_cat_Transportation, Construction, Ele...    0.283285\n",
            "4                               aia_first_to_file_True    0.252226\n",
            "6                                      years_since_pub    0.210495\n",
            "207  art_unit_cat_Mechanical Engineering, Manufactu...    0.160742\n",
            "98                                          country_JP    0.140740\n",
            "104                                         country_KR    0.137336\n",
            "184                                         country_TW    0.122012\n",
            "52                                          country_DE    0.110789\n",
            "205    art_unit_cat_Computer Architecture and Software    0.081882\n",
            "66                                          country_FR    0.068669\n",
            "None\n",
            "Model: LinR\n",
            "              precision    recall  f1-score   support\n",
            "\n",
            "           0       0.68      0.64      0.66    400461\n",
            "           1       0.65      0.69      0.67    381524\n",
            "\n",
            "    accuracy                           0.66    781985\n",
            "   macro avg       0.66      0.66      0.66    781985\n",
            "weighted avg       0.66      0.66      0.66    781985\n",
            "\n",
            "                                               feature  importance\n",
            "202         art_unit_cat_Biotech and Organic Chemistry    0.294347\n",
            "203    art_unit_cat_Chemical and Materials Engineering    0.191761\n",
            "210  art_unit_cat_Semiconductors/Memory, Circuits/M...    0.144455\n",
            "211  art_unit_cat_Transportation, Construction, Ele...    0.108674\n",
            "204                        art_unit_cat_Communications    0.104827\n",
            "207  art_unit_cat_Mechanical Engineering, Manufactu...    0.080446\n",
            "66                                          country_FR    0.068954\n",
            "208  art_unit_cat_Networking, Multiplexing, Cable, ...    0.065513\n",
            "187                                         country_US    0.056982\n",
            "2                             entity_size_UNDISCOUNTED    0.054890\n",
            "184                                         country_TW    0.053509\n",
            "0                                    entity_size_MICRO    0.050599\n",
            "201                                         country_na    0.049716\n",
            "104                                         country_KR    0.046551\n",
            "52                                          country_DE    0.045908\n",
            "6                                      years_since_pub    0.033566\n",
            "93                                          country_IT    0.032679\n",
            "139                                         country_NL    0.030390\n",
            "37                                          country_CA    0.030157\n",
            "39                                          country_CH    0.027357\n",
            "None\n",
            "Model: RF\n",
            "              precision    recall  f1-score   support\n",
            "\n",
            "           0       0.70      0.64      0.67    400461\n",
            "           1       0.65      0.71      0.68    381524\n",
            "\n",
            "    accuracy                           0.67    781985\n",
            "   macro avg       0.68      0.68      0.67    781985\n",
            "weighted avg       0.68      0.67      0.67    781985\n",
            "\n",
            "                     feature  importance\n",
            "0          entity_size_MICRO         NaN\n",
            "1          entity_size_SMALL         NaN\n",
            "2   entity_size_UNDISCOUNTED         NaN\n",
            "3    aia_first_to_file_False         NaN\n",
            "4     aia_first_to_file_True         NaN\n",
            "5       groupartunitnumber_x         NaN\n",
            "6            years_since_pub         NaN\n",
            "7                 country_AD         NaN\n",
            "8                 country_AE         NaN\n",
            "9                 country_AG         NaN\n",
            "10                country_AI         NaN\n",
            "11                country_AL         NaN\n",
            "12                country_AM         NaN\n",
            "13                country_AN         NaN\n",
            "14                country_AO         NaN\n",
            "15                country_AR         NaN\n",
            "16                country_AS         NaN\n",
            "17                country_AT         NaN\n",
            "18                country_AU         NaN\n",
            "19                country_AW         NaN\n",
            "None\n"
          ]
        },
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "/usr/local/lib/python3.12/dist-packages/sklearn/utils/validation.py:2739: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names\n",
            "  warnings.warn(\n"
          ]
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Model: GB\n",
            "              precision    recall  f1-score   support\n",
            "\n",
            "           0       0.72      0.64      0.68    400461\n",
            "           1       0.66      0.74      0.70    381524\n",
            "\n",
            "    accuracy                           0.69    781985\n",
            "   macro avg       0.69      0.69      0.69    781985\n",
            "weighted avg       0.69      0.69      0.69    781985\n",
            "\n",
            "                                               feature  importance\n",
            "5                                 groupartunitnumber_x        2994\n",
            "6                                      years_since_pub         920\n",
            "3                              aia_first_to_file_False         279\n",
            "98                                          country_JP         185\n",
            "187                                         country_US         157\n",
            "2                             entity_size_UNDISCOUNTED         136\n",
            "52                                          country_DE         124\n",
            "201                                         country_na         109\n",
            "44                                          country_CN         106\n",
            "66                                          country_FR         105\n",
            "104                                         country_KR          83\n",
            "210  art_unit_cat_Semiconductors/Memory, Circuits/M...          80\n",
            "0                                    entity_size_MICRO          72\n",
            "205    art_unit_cat_Computer Architecture and Software          66\n",
            "93                                          country_IT          64\n",
            "4                               aia_first_to_file_True          56\n",
            "184                                         country_TW          52\n",
            "39                                          country_CH          50\n",
            "209                                 art_unit_cat_Other          49\n",
            "1                                    entity_size_SMALL          47\n",
            "None\n"
          ]
        }
      ],
      "source": [
        "from sklearn.metrics import accuracy_score, f1_score, precision_score, recall_score, confusion_matrix, classification_report\n",
        "import cupy as cp\n",
        "\n",
        "label = '112 Rejections, no tfidf'\n",
        "no_tfidf = True\n",
        "X_train, X_test, y_train, y_test = dataset_organization[label]\n",
        "print(\"----------------------------\")\n",
        "print(label)\n",
        "print(\"----------------------------\")\n",
        "\n",
        "print(\"Converting training data to dense array for GPU...\")\n",
        "start_time = time.time()\n",
        "X_train_dense_gpu = cp.asarray(X_train.todense())\n",
        "end_time = time.time()\n",
        "print(f\"Conversion time: {end_time - start_time} seconds\")\n",
        "print(\"Converting testing data to dense array for GPU\")\n",
        "start_time = time.time()\n",
        "X_test_dense_gpu = cp.asarray(X_test.todense())\n",
        "end_time = time.time()\n",
        "print(f\"Conversion time: {end_time - start_time} seconds\")\n",
        "\n",
        "# get accuracy, F1, precision, recall, and confusion matrix\n",
        "models = create_models(X_train, y_train, X_train_gpu=X_train_dense_gpu)\n",
        "for model_name, model in models.items():\n",
        "\n",
        "    if model_name == 'RF':\n",
        "        y_pred = model.predict(X_test_dense_gpu)\n",
        "    else:\n",
        "      y_pred = model.predict(X_test)\n",
        "\n",
        "    # Convert continuous predictions to binary for LinearRegression\n",
        "    if model_name == 'LinR':\n",
        "        y_pred = (y_pred > 0.5).astype(int)\n",
        "\n",
        "    print(f\"Model: {model_name}\")\n",
        "    print(classification_report(y_test, y_pred))\n",
        "    print(importance_info(model, model_name, numeric_df, no_tfidf=no_tfidf))\n",
        "    # print(f\"Accuracy: {accuracy_score(y_test, y_pred)}\")\n",
        "    # print(f\"F1 Score: {f1_score(y_test, y_pred)}\")\n",
        "    # print(f\"Precision: {precision_score(y_test, y_pred)}\")\n",
        "    # print(f\"Recall: {recall_score(y_test, y_pred)}\")\n",
        "    # print(f\"Confusion Matrix: {confusion_matrix(y_test, y_pred)}\")\n",
        "    # print(\"\\n\")\n"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "import numpy as np\n",
        "\n",
        "# Get raw importance scores from LightGBM\n",
        "model = models[\"GB\"]\n",
        "importance = model.feature_importances_(importance_type=\"gain\")\n",
        "indices = np.argsort(importance)[::-1]  # descending\n",
        "\n",
        "n_total_features = len(importance)\n",
        "n_tfidf_features = tfidf_svd.shape[1]\n",
        "n_tab_features   = X_tab_numeric.shape[1]\n",
        "\n",
        "print(f\"Total features in model: {n_total_features}\")\n",
        "print(f\"TF-IDF feature count: {n_tfidf_features}\")\n",
        "print(f\"Tabular feature count: {n_tab_features}\")\n",
        "\n",
        "# Sanity check\n",
        "assert n_total_features == n_tfidf_features + n_tab_features, \\\n",
        "    \"Mismatch between TF-IDF + tabular features and model feature count.\"\n",
        "\n",
        "# Map indices back to human-readable names\n",
        "def feature_name_from_index(idx):\n",
        "    if idx < n_tfidf_features:\n",
        "        # We don't have the actual vocabulary mapping here, so label generically\n",
        "        return f\"TFIDF_term_{idx}\"\n",
        "    else:\n",
        "        tab_idx = idx - n_tfidf_features\n",
        "        return X_tab_numeric.columns[tab_idx]\n",
        "\n",
        "top_k = 30\n",
        "print(f\"\\nTop {top_k} features by gain:\")\n",
        "\n",
        "for rank, idx in enumerate(indices[:top_k], start=1):\n",
        "    if importance[idx] <= 0:\n",
        "        continue\n",
        "    name = feature_name_from_index(idx)\n",
        "    print(f\"{rank:2d}. {name:60s}  gain={importance[idx]:.4f}\")"
      ],
      "metadata": {
        "id": "6kSIL2cDdwl_",
        "outputId": "84cc613e-3e92-4fd9-fa24-8490e85fcad8",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 211
        }
      },
      "id": "6kSIL2cDdwl_",
      "execution_count": 37,
      "outputs": [
        {
          "output_type": "error",
          "ename": "TypeError",
          "evalue": "'numpy.ndarray' object is not callable",
          "traceback": [
            "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
            "\u001b[0;31mTypeError\u001b[0m                                 Traceback (most recent call last)",
            "\u001b[0;32m/tmp/ipython-input-4119471814.py\u001b[0m in \u001b[0;36m<cell line: 0>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0;31m# Get raw importance scores from LightGBM\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0mmodel\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmodels\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"GB\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 5\u001b[0;31m \u001b[0mimportance\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmodel\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfeature_importances_\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimportance_type\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"gain\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      6\u001b[0m \u001b[0mindices\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mnp\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0margsort\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimportance\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m-\u001b[0m\u001b[0;36m1\u001b[0m\u001b[0;34m]\u001b[0m  \u001b[0;31m# descending\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      7\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
            "\u001b[0;31mTypeError\u001b[0m: 'numpy.ndarray' object is not callable"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "715c40a3",
      "metadata": {
        "id": "715c40a3"
      },
      "outputs": [],
      "source": [
        "rf_params_random = get_best_random_rf_params(X_train, y_train)\n",
        "gb_params_random = get_best_random_gb_params(X_train, y_train)\n",
        "rf_params_grid = get_best_grid_search_rf_model(X_train, y_train, rf_params_random)\n",
        "gb_params_grid = get_best_grid_search_gb_model(X_train, y_train, gb_params_random)"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "rf_params_random = get_best_random_rf_params(X_train_dense_gpu, y_train)\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "5wXKTJlTtrNM",
        "outputId": "9a023b6a-f118-460f-a3e5-2ae2088fd9ac"
      },
      "id": "5wXKTJlTtrNM",
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n",
            "Unused keyword parameter: ccp_alpha during cuML estimator initialization\n",
            "Unused keyword parameter: monotonic_cst during cuML estimator initialization\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "gb_params_random = get_best_random_gb_params(X_train, y_train)\n"
      ],
      "metadata": {
        "id": "wSWtc_iStq_Y"
      },
      "id": "wSWtc_iStq_Y",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "rf_params_grid = get_best_grid_search_rf_model(X_train_dense_gpu, y_train, rf_params_random)\n"
      ],
      "metadata": {
        "id": "DWlQX6ECtq1w"
      },
      "id": "DWlQX6ECtq1w",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "gb_params_grid = get_best_grid_search_gb_model(X_train, y_train, gb_params_random)"
      ],
      "metadata": {
        "id": "-Zg79OU6tuqi"
      },
      "id": "-Zg79OU6tuqi",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "pip install xgboost"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "FO6ivfk679Vb",
        "outputId": "292a66f5-7e3f-4f46-c808-12cb9383f7af"
      },
      "id": "FO6ivfk679Vb",
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Requirement already satisfied: xgboost in /usr/local/lib/python3.12/dist-packages (3.0.5)\n",
            "Requirement already satisfied: numpy in /usr/local/lib/python3.12/dist-packages (from xgboost) (2.0.2)\n",
            "Requirement already satisfied: nvidia-nccl-cu12 in /usr/local/lib/python3.12/dist-packages (from xgboost) (2.27.3)\n",
            "Requirement already satisfied: scipy in /usr/local/lib/python3.12/dist-packages (from xgboost) (1.16.2)\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "from xgboost import XGBClassifier\n",
        "from sklearn.metrics import accuracy_score, f1_score, precision_score, recall_score\n",
        "gb_model = XGBClassifier(n_estimators=100)\n",
        "gb_model.fit(X_train, y_train)\n",
        "y_pred = gb_model.predict(X_test)\n",
        "print(f\"Accuracy: {accuracy_score(y_test, y_pred)}\")\n",
        "print(f\"F1 Score: {f1_score(y_test, y_pred)}\")\n",
        "print(f\"Precision: {precision_score(y_test, y_pred)}\")\n",
        "print(f\"Recall: {recall_score(y_test, y_pred)}\")\n",
        "print(f\"Confusion Matrix: {confusion_matrix(y_test, y_pred)}\")\n",
        "print(\"\\n\")\n",
        "\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "AEn-batItzMZ",
        "outputId": "dd1d298c-3437-45ac-85ef-dd8136ed02a9"
      },
      "id": "AEn-batItzMZ",
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Accuracy: 0.796836256449932\n",
            "F1 Score: 0.46561878781966975\n",
            "Precision: 0.674199549975161\n",
            "Recall: 0.35560373616662727\n",
            "Confusion Matrix: [[553900  33447]\n",
            " [125424  69214]]\n",
            "\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [],
      "metadata": {
        "id": "-Elw9jK_71la"
      },
      "id": "-Elw9jK_71la",
      "execution_count": null,
      "outputs": []
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    },
    "language_info": {
      "codemirror_mode": {
        "name": "ipython",
        "version": 3
      },
      "file_extension": ".py",
      "mimetype": "text/x-python",
      "name": "python",
      "nbconvert_exporter": "python",
      "pygments_lexer": "ipython3",
      "version": "3.13.5"
    },
    "colab": {
      "provenance": [],
      "machine_shape": "hm",
      "gpuType": "A100",
      "runtime_attributes": {
        "runtime_version": "2025.10"
      }
    },
    "accelerator": "GPU"
  },
  "nbformat": 4,
  "nbformat_minor": 5
}